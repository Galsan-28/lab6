# lab6
## Лабораторная работа 6: Рефакторинг и Code Smells

## Описание работы

В рамках лабораторной работы проведен рефакторинг кода модуля обработки заказов `order_processing.py` с сохранением исходного поведения, проверяемого тестами.

## Найденные проблемы качества кода (Code Smells)

### 1. Длинная функция (Long Method)
Функция `process_checkout()` содержала более 50 строк и выполняла множество различных операций:
- Парсинг запроса
- Валидацию данных
- Расчеты стоимости
- Применение скидок
- Расчет налогов
- Формирование ответа

### 2. Нарушение принципа единственной ответственности (SRP)
Одна функция занималась всеми аспектами обработки заказа.

### 3. Магические числа (Magic Numbers)
В коде присутствовали непонятные значения:
- `0.21` - ставка налога
- `0.10`, `0.20`, `0.05` - проценты скидок
- `50`, `10` - фиксированные скидки
- `200`, `100` - пороги для скидок

### 4. Сложная логика условий
Много вложенных условий для расчета разных типов скидок.

### 5. Дублирование кода
Несколько проверок на положительность значений в разных местах.

### 6. Некорректные проверки типов
Использование `type(items) is not list` вместо `isinstance(items, list)`.

## Примененные рефакторинги

### 1. Разделение ответственности
Выделены отдельные функции для каждой операции:
- `parse_request()` - извлечение данных из запроса
- `validate_request()` - валидация всех входных данных
- `calculate_subtotal()` - расчет суммы без скидок
- `calculate_discount()` - расчет скидки
- `calculate_tax()` - расчет налога
- `generate_order_id()` - генерация ID заказа

### 2. Вынесение констант
Созданы именованные константы:
```python
DEFAULT_CURRENCY = "USD"
TAX_RATE = 0.21
COUPON_RATES = {
    "SAVE10": 0.10,
    "SAVE20": {"base": 0.05, "threshold": 200, "bonus": 0.20},
    "VIP": {"base": 10, "threshold": 100, "bonus": 50}
}
MIN_PRICE = 0
MIN_QTY = 0
